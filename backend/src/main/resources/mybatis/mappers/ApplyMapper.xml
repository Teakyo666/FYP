<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.backend.Mappers.ApplyMapper">

    <!-- Result mapping: mapping database fields to DO properties -->
    <resultMap id="ApplyResultMap" type="com.example.backend.POJO.DO.ApplyDO">
        <id column="id" property="id"/> <!-- Primary key mapping -->
        <result column="user_id" property="user_id"/>
        <result column="to_apply" property="to_apply"/>
        <result column="reason" property="reason" jdbcType="LONGVARCHAR"/>
        <result column="status" property="status"/>
    </resultMap>

    <!-- Insert application record -->
    <insert id="insert" parameterType="com.example.backend.POJO.DO.ApplyDO">
        INSERT INTO apply (
            id, user_id, to_apply, reason, status
        ) VALUES (
                     #{id}, #{user_id}, #{to_apply}, #{reason}, #{status}
                 )
    </insert>

    <!-- Physical delete by ID -->
    <delete id="deleteById" parameterType="java.lang.String">
        DELETE FROM apply WHERE id = #{id}
    </delete>

    <!-- Update all fields by ID -->
    <update id="update" parameterType="com.example.backend.POJO.DO.ApplyDO">
        UPDATE apply
        SET
            user_id = #{user_id},
            to_apply = #{to_apply},
            reason = #{reason},
            status = #{status}
        WHERE id = #{id}
    </update>

    <!-- Query by ID (filtering deleted data) -->
    <select id="selectById" parameterType="java.lang.String" resultMap="ApplyResultMap">
        SELECT id, user_id, to_apply, reason, status
        FROM apply
        WHERE id = #{id}
    </select>

    <!-- Query all application records -->
    <select id="selectAll" resultMap="ApplyResultMap">
        SELECT id, user_id, to_apply, reason, status
        FROM apply
        ORDER BY id DESC
    </select>
    
    <!-- Conditional query application records -->
    <select id="selectByCondition" resultMap="ApplyResultMap">
        SELECT id, user_id, to_apply, reason, status
        FROM apply
        <where>
            <if test="to_apply != null and to_apply != ''">
                AND to_apply = #{to_apply}
            </if>
            <if test="status != null and status != ''">
                AND status = #{status}
            </if>
        </where>
        ORDER BY id DESC
    </select>

</mapper>