<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.backend.Mappers.RecycleMapper">

    <!-- Result mapping: Database fields â†’ DO properties (explicit mapping to avoid ambiguity) -->
    <resultMap id="RecycleResultMap" type="com.example.backend.POJO.DO.RecycleDO">
        <id column="id" property="id"/>
        <result column="country" property="country"/>
        <result column="city" property="city"/>
        <result column="address" property="address"/>
        <result column="name" property="name"/>
        <result column="user_id" property="user_id"/>
        <result column="description" property="describe"/>
    </resultMap>

    <!-- Insert -->
    <insert id="insert" parameterType="com.example.backend.POJO.DO.RecycleDO">
        INSERT INTO recycle_place (
            id,
            country,
            city,
            address,
            name,
            user_id,
            description
        ) VALUES (
                     #{id},
                     #{country},
                     #{city},
                     #{address},
                     #{name},
                     #{user_id},
                     #{describe}
                 )
    </insert>

    <!-- Delete -->
    <delete id="deleteById" parameterType="java.lang.String">
        DELETE FROM recycle_place WHERE id = #{id}
    </delete>

    <!-- Update -->
    <update id="update" parameterType="com.example.backend.POJO.DO.RecycleDO">
        UPDATE recycle_place
        SET
            country = #{country},
            city = #{city},
            address = #{address},
            name = #{name},
            user_id = #{user_id},
            description = #{describe}
        WHERE id = #{id}
    </update>

    <!-- Query by ID -->
    <select id="selectById" parameterType="java.lang.String" resultMap="RecycleResultMap">
        SELECT id, country, city, address, name, user_id, description
        FROM recycle_place
        WHERE id = #{id}
    </select>

    <!-- Query all -->
    <select id="selectAll" resultMap="RecycleResultMap">
        SELECT id, country, city, address, name, user_id, description
        FROM recycle_place
        ORDER BY id DESC
    </select>

    <!-- Conditional query (fuzzy search by name) -->
    <select id="selectByCondition" parameterType="java.lang.String" resultMap="RecycleResultMap">
        SELECT id, country, city, address, name, user_id, description
        FROM recycle_place
        <where>
            <if test="name != null and name != ''">
                AND name LIKE CONCAT('%', #{name}, '%')
            </if>
        </where>
        ORDER BY id DESC
    </select>

    <!-- Query by country and city -->
    <select id="selectByCountryAndCity" resultMap="RecycleResultMap">
        SELECT id, country, city, address, name, user_id, description
        FROM recycle_place
        WHERE country = #{country} AND city = #{city}
    </select>

</mapper>